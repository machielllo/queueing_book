\usepackage{classicthesis}
\usepackage{imakeidx}
\makeindex[columns=2, title=Index]

\usepackage{natbib}
\usepackage[english]{babel}
\usepackage{graphicx}
\usepackage{mathtools,amsthm,amssymb,amsmath}
\usepackage{verbatim}
\usepackage{enumitem}
\usepackage{sidenotes}

\numberwithin{equation}{section}

%\usepackage{mathpazo} % werkt niet met pyconsole >>> wordt ???
\usepackage{fouriernc}

\usepackage{geometry}
\newgeometry{left=1.8cm,right=1.8cm,top=2.2cm,bottom=3cm,marginparsep=1.2cm,marginparwidth=4.5cm,includemp} %,showframe}
\savegeometry{tufte}
\newgeometry{left=3cm,right=3cm,bottom=3cm}
\savegeometry{normal}


\usepackage{pgf}
\usepackage{tikz}
\usetikzlibrary{arrows,automata,positioning,arrows.meta}
\usetikzlibrary{decorations.markings}
\usepackage{pgfplots}
\pgfplotsset{compat=newest}
\usepgfplotslibrary{groupplots}

% I don't know why, pythontext should appear somewhere above some
% other packages. I don't know which ones, but at this spot it works.
\usepackage{pythontex}

\usepackage{subfiles}
% load subfiles before the comment package to avoid problems during compiliaton.
%\usepackage{comment}


\usepackage[capitalize]{cleveref}
\usepackage{xr}


\opt{all-solutions-at-end}{
\usepackage{answers}
\Newassociation{solution}{Solution}{ans}
\Newassociation{hint}{Hint}{hint}
\renewcommand{\Hintlabel}[1]{\textbf{h.#1.}}
\renewcommand{\Solutionlabel}[1]{\textbf{s.#1.}}

}


\opt{solutionfiles}{
\usepackage{answers}
\Newassociation{solution}{Solution}{ans}
\Newassociation{hint}{Hint}{hint}
\renewcommand{\Hintlabel}[1]{\textbf{h.#1.}}
\renewcommand{\Solutionlabel}[1]{\textbf{s.#1.}}
}

\opt{nosolutionfiles}{
\excludecomment{hint}
\excludecomment{solution}
}

\opt{check}{
\usepackage[nosolutionfiles]{answers}
\Newassociation{solution}{Solution}{ans}
\Newassociation{hint}{Hint}{hint}
\renewcommand{\Hintlabel}[1]{\textbf{h.#1.}}
\renewcommand{\Solutionlabel}[1]{\textbf{s.#1.}}
\AtEndEnvironment{exercise}{\clearpage} %  each exercise on a new page
% \usepackage{showlabels}  % check on all labels, similar to refcheck
}

\counterwithin*{sidenote}{section}


% I don't like slanted fonts in the exercises
\theoremstyle{definition}
%\newtheorem{theorem}{Theorem}[section]
\newtheorem{exercise}{Ex}[section]

\crefname{equation}{}{}
\crefformat{exercise}{[#2#1#3]}
\crefformat{marginexercise}{[#2#1#3]}
\crefrangeformat{exercise}{[#3#1#4] to~[#5#2#6]}
\crefmultiformat{exercise}{[#2#1#3]}{ and~[#2#1#3]}{, [#2#1#3]}{ and~]#2#1#3]}

\newskip\tufteskipamount
\tufteskipamount=.5\baselineskip plus 0.5ex minus 0.2ex

\newcommand{\tuftebreak}{\par\ifdim\lastskip<\tufteskipamount
  \removelastskip\penalty-100\tufteskip\fi}

\newcommand{\tufteskip}{\vspace\tufteskipamount}

\makeatletter
\def\tuftebreak{%
  \if@nobreak\else
    \par
    \ifdim\lastskip<\tufteskipamount
      \removelastskip \penalty -100
      \tufteskip
    \fi
  \fi
}
\makeatother

\newcommand{\newthought}[1]{
\tuftebreak
\noindent\textsc{#1}}



\newcommand{\N}{\mathbb{N}}
\newcommand{\R}{\mathbb{R}}
\newcommand{\Z}{\mathbb{Z}}
\DeclareMathOperator{\Exp}{Exp}
\DeclareMathOperator*{\argmin}{arg\,min}

\newcommand{\abs}[1]{\left\vert#1\right\vert}
\newcommand{\given}{\,\middle|\,}
\renewcommand{\P}[1]{\,\mathsf{P}\left\{#1\right\}}
\newcommand{\E}[1]{\,\mathsf{E}\left[#1\right]}
\newcommand{\V}[1]{\,\mathsf{V}\left[#1\right]}
\renewcommand{\d}[1]{\,\textrm{d}#1}
\newcommand{\1}[1]{\,\mathbb{1}_{#1}} % indicator
\renewcommand{\TH}{\mathrm{TH}} % indicator

\newcommand{\Q}{Q} % queue length
\renewcommand{\L}{L} % number in system
\newcommand{\J}{J} % sojourn time
\newcommand{\U}{U} % busy time
\newcommand{\W}{W} % waiting time (in queue)
\newcommand{\Ls}{L_s} % number at server

% testen of losse L, W of Q nog voorkomt
% \renewcommand{\E}[1]{Q\left.#1\right.}
% \renewcommand{\Q}{aap} % queue length
% \renewcommand{\L}{beer} % number in system
% \renewcommand{\J}{peer} % sojourn time
% \renewcommand{\W}{appel} % waiting time (in queue)
% \renewcommand{\Ls}{melo} % number at server

\newcommand{\recall}[1]{#1\index{#1}\sidenote{\MakeUppercase #1}}
